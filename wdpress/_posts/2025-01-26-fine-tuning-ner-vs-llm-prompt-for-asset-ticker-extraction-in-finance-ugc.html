---
layout: post
title: Fine-tuning NER vs LLM prompt for asset ticker extraction in finance UGC
date: 2025-01-26 17:37:45.000000000 +08:00
type: post
parent_id: '0'
published: true
password: ''
status: publish
categories: []
tags:
- AI
- Fine-tune
- GLiNER
- LLM
- Name entity recognition
- prompt engineering
meta:
  _g_feedback_shortcode_49fa89583a1c6ea48df01badfadabe511e5b5074: "\n\t\t\t\t[contact-field
    label=\"Name\" type=\"name\"  required=\"true\" /]\n\t\t\t\t[contact-field label=\"Email\"
    type=\"email\" required=\"true\" /]\n\t\t\t\t[contact-field label=\"Website\"
    type=\"url\" /]\n\t\t\t\t[contact-field label=\"Message\" type=\"textarea\" /]"
  _g_feedback_shortcode_atts_49fa89583a1c6ea48df01badfadabe511e5b5074: a:17:{s:2:"to";s:19:"c013a2015@gmail.com";s:7:"subject";s:22:"[AI,
    Tech &amp; Life] ";s:12:"show_subject";s:2:"no";s:6:"widget";i:0;s:14:"block_template";N;s:19:"block_template_part";N;s:2:"id";i:2478;s:18:"submit_button_text";s:6:"Submit";s:14:"customThankyou";s:0:"";s:21:"customThankyouHeading";s:26:"Your
    message has been sent";s:21:"customThankyouMessage";s:30:"Thank you for your submission!";s:22:"customThankyouRedirect";s:0:"";s:10:"jetpackCRM";b:1;s:9:"className";N;s:9:"postToUrl";N;s:14:"salesforceData";N;s:12:"hiddenFields";N;}
  _last_editor_used_jetpack: block-editor
  firehose_sent: '1737884267'
  _publicize_job_id: '101228945595'
  timeline_notification: '1737884270'
  _elasticsearch_data_sharing_indexed_on: '2025-01-26 09:37:45'
  _publicize_done_external: a:1:{s:8:"facebook";a:1:{i:26861408;s:53:"https://facebook.com/1630088060609695_635478149008352";}}
  _publicize_shares: a:9:{s:6:"status";s:7:"success";s:7:"message";s:53:"https://facebook.com/1630088060609695_635478149008352";s:9:"timestamp";i:1737884275;s:7:"service";s:8:"facebook";s:13:"connection_id";i:23923317;s:11:"external_id";s:16:"1630088060609695";s:13:"external_name";s:2:"Sw";s:15:"profile_picture";s:341:"https://scontent-lax3-1.xx.fbcdn.net/v/t1.30497-1/453178253_471506465671661_2781666950760530985_n.png?stp=cp0_dst-png_s50x50&_nc_cat=110&ccb=1-7&_nc_sid=22ec41&_nc_ohc=UB459iPQgKoQ7kNvgH4B0oI&_nc_zt=24&_nc_ht=scontent-lax3-1.xx&edm=AGaHXAAEAAAA&_nc_gid=A8k5GfB6_RC0m_3eDbxpvfS&oh=00_AYBUFbBN78b80-DLpHfme4pN4C_zDskzoIXO43Zh9uWpYA&oe=67A8A57A";s:12:"profile_link";s:41:"https://www.facebook.com/1630088060609695";}
  _publicize_done_23923317: '1'
  _wpas_done_26861408: '1'
author:
  login: c013a2015
  email: c013a2015@gmail.com
  display_name: sheng gao
  first_name: sheng
  last_name: gao
permalink: "/2025/01/26/fine-tuning-ner-vs-llm-prompt-for-asset-ticker-extraction-in-finance-ugc/"
---
<p><!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"><br />
<!-- wp:paragraph --><html><body></p>
<p>With the increasing multiple-task capability of LLM model, it makes it easy to do specific ML task by prompting LLM to focus on specified task, such as sentiment classification, name entity recognition, document analysis, OCR, et al. Before LLM, it needs to collect domain data and train particular ML model to complete these tasks. Easily and quickly developing product by calling LLM API such as openapi, azure, google gemini, does not mean the performance match requirement in practice. Only depending on prompt engineering cannot handle wrong cases and consistently improve performance. Let alone hallucination in LLM.  </p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>In the post, I study how LLM works in asset ticker (stock ticker, crypto ticker, forex code) extraction from user message in the AI based fintech product. I will compare prompt engineering based LLM (commercial API) with specific NER model, <a href="https://github.com/urchade/GLiNER">GLiNER</a>, which demonstrates good performance in many tasks, and fine-tuned version using internal data.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>We collect a few ten thousands of user messages and LLM extracted tickers, which is treated as a ground-truth data when fine-tuning GLiNER model. </p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:heading {"level":5} --></p>
<h5 class="wp-block-heading"> How LLM perform in finance UGC?</h5>
<p><!-- /wp:heading --></p>
<p><!-- wp:list --></p>
<ul class="wp-block-list">
<!-- wp:list-item --></p>
<li>Analysis on message containing tickers</li>
<p><!-- /wp:list-item -->
</ul>
<p><!-- /wp:list --></p>
<p><!-- wp:paragraph --></p>
<p>Randomly select 50 samples which LLM find at least one ticker and manually check and annotate truth tickers. Compared with human label, LLM only has F1 62% with recall only about 52%. </p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>Even in the small randomly selected set, there are a few hallucination cases found, i.e. LLM output tickers that does not exist in the user message, e.g. "provide an in-the-money options trade for one of the companies (UnitedHealth Group Inc, AbbVie Inc) with an expiration date of  xxx", which LLM output tickers such as "UNH, ABBV". </p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:list --></p>
<ul class="wp-block-list">
<!-- wp:list-item --></p>
<li>Analysis on message not containing tickers</li>
<p><!-- /wp:list-item -->
</ul>
<p><!-- /wp:list --></p>
<p><!-- wp:paragraph --></p>
<p>Randomly select 50 samples which LLM cannot find any ticker and manually check and annotate. It is found there is 14 messages which actually contain tickers, but LLM misses.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:heading {"level":5} --></p>
<h5 class="wp-block-heading">NER task-specific GLiNER</h5>
<p><!-- /wp:heading --></p>
<p><!-- wp:paragraph --></p>
<p>Based on our internal user messages and LLM generated tickers, randomly samples about 10K balanced samples (messages with/without tickers) to study performance. We also samples a few ten thousands of messages with tickers to fine-tune GLiNER. Based on these train data &amp; test set, we compare F1 on asset ticker aamong</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:list --></p>
<ul class="wp-block-list">
<!-- wp:list-item --></p>
<li>Pretrained model (small &amp; large): it is found small model works better than large model in out data set</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Fine-tuned pretrained model with full layers (small)</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Fine-tuned pretrained model with frozen layers (small)</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Fine-tuned pretrained model with frozen layers (small) plus valid ticker filters</li>
<p><!-- /wp:list-item -->
</ul>
<p><!-- /wp:list --></p>
<p><!-- wp:paragraph --></p>
<p>Here is a F1 metric summary.  </p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:table --></p>
<figure class="wp-block-table">
<table class="has-fixed-layout">
<tbody>
<tr>
<td>GLiNER Model</td>
<td>F1</td>
</tr>
<tr>
<td>Pretrained small</td>
<td>43%</td>
</tr>
<tr>
<td>Pretrained large</td>
<td>18%</td>
</tr>
<tr>
<td>Fine-tuned small (full layers)</td>
<td>79%</td>
</tr>
<tr>
<td>Fine-tuned small with frozen layers</td>
<td>85%</td>
</tr>
<tr>
<td>Fine-tuned small with frozen layers + valid ticker filter</td>
<td>91%</td>
</tr>
</tbody>
</table>
</figure>
<p><!-- /wp:table --></p>
<p><!-- wp:heading {"level":5} --></p>
<h5 class="wp-block-heading">Conclusion</h5>
<p><!-- /wp:heading --></p>
<p><!-- wp:list --></p>
<ul class="wp-block-list">
<!-- wp:list-item --></p>
<li>Fine-tune pretrained model using domain data always better than pretrained, which is normal and common practice</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>When training data is not BIG, only train selected layers (normally these layers in the output or closest. Embedding layer as a feature extraction layer, normally we frozen) is better. It is also a common practice when fine-tuning.</li>
<p><!-- /wp:list-item --></p>
<p><!-- wp:list-item --></p>
<li>Analysis on the result show many wrong extracted tickers, which are actually not valid based on domain knowledge, thus using domain knowledge as filter will improve precision</li>
<p><!-- /wp:list-item -->
</ul>
<p><!-- /wp:list --></p>
<p><!-- wp:heading {"level":6} --></p>
<h6 class="wp-block-heading">How GLiNER works on messages of LLM without tickers</h6>
<p><!-- /wp:heading --></p>
<p><!-- wp:paragraph --></p>
<p>Using above 50 samples where LLM without empty, it is found GLiNer achieves F1 59% with recall &gt;90%. Thus GLiNER will increase recall as expected.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p>More importantly, Small GLiNER can deploy in CPU-only service. It can improve response latency (calling commercial LLM API, e.g. openAPI may need a few seconds), no hallucination, good data privacy, and performance.</p>
<p><!-- /wp:paragraph --></p>
<p><!-- wp:paragraph --></p>
<p><!-- /wp:paragraph --><br />
</body></html></p>
